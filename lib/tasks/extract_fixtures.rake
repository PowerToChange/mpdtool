desc 'Create YAML test fixtures from data in an existing database.  Defaults to development database.  Set RAILS_ENV to override.'
task :extract_fixtures => :environment do 
  sql = "SELECT * FROM %s"
  skip_tables = ["schema_info",
                 "academic_departments",
                 "am_friends_people",
                 "am_group_links",
                 "am_group_messages",
                 "am_groups_people",
                 "am_groups",
                 "am_personal_links",
                 "aoas",
                 "ap_signup",
                 "cms_assoc_filecategory",
                 "cms_cmscategory",
                 "cms_cmsfile",
                 "contacts",
                 "countries",
                 "crs_answer",
                 "crs_childregistration",
                 "crs_conference",
                 "crs_customitem",
                 "crs_merchandise",
                 "crs_merchandisechoice",
                 "crs_payment",
                 "crs_question",
                 "crs_questiontext",
                 "crs_registration",
                 "crs_registrationtype",
                 "crs_report",
                 "fsk_allocations",
                 "fsk_fields_roles",
                 "fsk_fields",
                 "fsk_kit_categories",
                 "fsk_line_items",
                 "fsk_orders",
                 "fsk_products",
                 "fsk_roles",
                 "fsk_users",
                 "hr_ms_payment",
                 "hr_review360_review360",
                 "hr_review360_review360light",
                 "hr_review360_reviewsession",
                 "hr_review360_reviewsessionlight",
                 "hr_si_application_2003_deprecated",
                 "hr_si_application_2004_deprecated",
                 "hr_si_application_2005_deprecated",
                 "hr_si_application_2006_deprecated",
                 "hr_si_applications",
                 "hr_si_payment",
                 "hr_si_project",
                 "hr_si_reference_2003_deprecated",
                 "hr_si_reference_2004_deprecated",
                 "hr_si_reference_2005_deprecated",
                 "hr_si_reference_2006_deprecated",
                 "hr_si_reference",
                 "hr_si_users",
                 "linczone_contacts",
                 "ministries",
                 "ministry_activity",
                 "ministry_address",
                 "ministry_assoc_activitycontact",
                 "ministry_assoc_dependents",
                 "ministry_assoc_otherministries",
                 "ministry_authorization",
                 "ministry_changerequest",
                 "ministry_dependent",
                 "ministry_fieldchange",
                 "ministry_locallevel",
                 "ministry_newaddress",
                 "ministry_noncccmin",
                 "ministry_note",
                 "person_aug1",
                 "ministry_regionalstat",
                 "ministry_regionalteam",
                 "ministry_staff",
                 "ministry_staffchangerequest",
                 "ministry_statistic",
                 "ministry_targetarea",
                 "nag_emails",
                 "old_wsn_sp_wsnapplication",
                 "oncampus_orders",
                 "oncampus_uses",
                 "plugin_schema_info",
                 "questionnaires",
                 "rails_crons",
                 "roles",
                 "sitrack_application_all_deprecated",
                 "sitrack_children",
                 "sitrack_columns",
                 "sitrack_enum_values",
                 "sitrack_feeds",
                 "sitrack_forms",
                 "sitrack_mpd",
                 "sitrack_queries",
                 "sitrack_saved_criteria",
                 "sitrack_sessions",
                 "sitrack_session_values",
                 "sitrack_tracking",
                 "sitrack_users",
                 "sitrack_view_columns",
                 "sitrack_views",
                 "sp_answers",
                 "sp_donations",
                 "sp_elements",
                 "sp_evaluations",
                 "sp_ministry_focuses_projects",
                 "sp_ministry_focuses",
                 "sp_page_elements",
                 "sp_pages",
                 "sp_payments",
                 "sp_project_versions",
                 "sp_question_options",
                 "sp_questionnaire_pages",
                 "sp_references",
                 "sp_roles",
                 "sp_staff",
                 "sp_stats",
                 "sp_users",
                 "staffsite_staffsitepref",
                 "staffsite_staffsiteprofile",
                 "summer_placement_preferences",
                 "users",
                 "wsn_sp_answer",
                 "wsn_sp_question",
                 "wsn_sp_questiontext",
                 "wsn_sp_reference",
                 "wsn_sp_wsnapplication",
                 "wsn_sp_wsndonations",
                 "wsn_sp_wsnevaluation",
                 "wsn_sp_wsnproject",
                 "wsn_sp_wsnusers"
                 ]
  ActiveRecord::Base.establish_connection
  (ActiveRecord::Base.connection.tables - skip_tables).each do |table_name|
    i = "000"
    File.open("#{RAILS_ROOT}/test/fixtures/#{table_name}.yml", 'w+') do |file|
      data = ActiveRecord::Base.connection.select_all(sql % table_name)
      file.write data.inject({}) { |hash, record|
        hash["#{table_name}_#{i.succ!}"] = record
        hash
       }.to_yaml
    end
  end
end